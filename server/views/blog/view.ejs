<!DOCTYPE html>
<html>
  <%- include('../partials/head.ejs', {title: "Bloggy: " + blog.title }); %>
  <body>
    <!-- Displays the blog --------------------------------------------------------------------------------------------------------------- -->
    <div class="blogView"><div class="individual">
      <div class="titleLine">
        <h2><%= blog.title %></h2>
          <% if(hasOwnProperty("User") && User == blog.user) { %> 
            <div class="smallButtons">
              <a href="/blog/edit?blogId=<%= blog.id %>">
                <button>Edit</button>
              </a>
              <form action="/blog/delete" method="post">
                <input type="hidden" name="blogId" value="<%= blog.id %>">
                <button>Delete</button>
              </form>
            </div>
          <% } %> 
      </div>
      <i id="blog<%= blog.id %>"><%= blog.date_utc %></i>
      <script> //I hate this but gonna leave it
        var dateOptions<%= blog.id %> = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'};
        var timeOptions<%= blog.id %> = { hour: "numeric", minute: "2-digit" };
        const dateElement<%= blog.id %> = document.getElementById("blog<%= blog.id %>");
        const date<%= blog.id %> = new Date(dateElement<%= blog.id %>.innerHTML);
        dateElement<%= blog.id %>.innerHTML = 
          date<%= blog.id %>.toLocaleDateString(undefined, dateOptions<%= blog.id %>) + " at " + 
          date<%= blog.id %>.toLocaleTimeString(undefined, timeOptions<%= blog.id %>);
      </script>
      <br><br>
      <p><%= blog.body %></p>
    </div></div>
    <!-- Displays the Comments ----------------------------------------------------------------------------------------------------------- -->
    <div class="createComment">
      <h1>Write a Comment</h1>
      <form action="/blog/comment" method="post">
        <input type="hidden" name="blogId" value=<%= blog.id %>>
        <textarea name="blogComment" id="blogComment" required="true"></textarea>
        <br>
        <input class="button" type="submit" value="Comment">
      </form>
      <br>
      <h1>Comments</h1>
    </div>
    
    <div class="blogView">
      <% for(var row of CommentData) { %>
        <div class="blogRow">
          <div class="titleLine">
            <h3><%= row.commenter %></h3>
            <% if(hasOwnProperty("User") && User == row.commenter) { %>
              <div class="smallButtons">
                <a href="/blog/comment/edit?commentId=<%= row.comment_id %>">
                  <button>Edit</button>
                </a>
                <form action="/blog/comment/delete" method="post">
                  <input type="hidden" name="commentId" value="<%= row.comment_id %>">
                  <button>Delete</button>
                </form>
              </div>
            <% } %>
          </div>
          <i id="blog<%= row.id %>"><%= row.date_utc %></i>
          <script> //I hate this but gonna leave it
            var dateOptions<%= row.id %> = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'};
            var timeOptions<%= row.id %> = { hour: "numeric", minute: "2-digit" };
            const dateElement<%= row.id %> = document.getElementById("blog<%= row.id %>");
            const date<%= row.id %> = new Date(dateElement<%= row.id %>.innerHTML);
            dateElement<%= row.id %>.innerHTML = 
              date<%= row.id %>.toLocaleDateString(undefined, dateOptions<%= row.id %>) + " at " + 
              date<%= row.id %>.toLocaleTimeString(undefined, timeOptions<%= row.id %>);
          </script>
          <br>
          <p><%= row.body %></p>
        </div>
      <% } %>
    </div>
  </body>
</html>